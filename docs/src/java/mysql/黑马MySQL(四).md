# 1ã€å¤šè¡¨æ“ä½œ

MySQLå¤šè¡¨ä¹‹é—´çš„å…³ç³»å¯ä»¥æ¦‚æ‹¬ä¸ºï¼šä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤š/å¤šå¯¹ä¸€å…³ç³»ï¼Œå¤šå¯¹å¤š

## 1.1ã€ä¸€å¯¹ä¸€

- ä¸€ä¸ªå­¦ç”Ÿåªæœ‰ä¸€å¼ èº«ä»½è¯ï¼›ä¸€å¼ èº«ä»½è¯åªèƒ½å¯¹åº”ä¸€å­¦ç”Ÿã€‚
- åœ¨ä»»ä¸€è¡¨ä¸­æ·»åŠ å”¯ä¸€å¤–é”®ï¼ŒæŒ‡å‘å¦ä¸€æ–¹ä¸»é”®ï¼Œç¡®ä¿ä¸€å¯¹ä¸€å…³ç³»ã€‚
- **ä¸€èˆ¬ä¸€å¯¹ä¸€å…³ç³»å¾ˆå°‘è§ï¼Œé‡åˆ°ä¸€å¯¹ä¸€å…³ç³»çš„è¡¨æœ€å¥½æ˜¯åˆå¹¶è¡¨ã€‚**

å¦‚ä¸‹æ–¹ä¸¤å¼ è¡¨ï¼Œå·¦è¾¹è¡¨çš„ä¸€è¡Œå¯¹åº”å³è¾¹è¡¨çš„ä¸€è¡Œã€‚åœ¨è¿™ç§ä¸€å¯¹ä¸€çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸¤å¼ è¡¨åˆäºŒä¸ºä¸€ï¼šå°†èº«ä»½è¯è¡¨çš„idã€numberå­—æ®µè¦†ç›–å­¦ç”Ÿè¡¨çš„ cid å­—æ®µã€‚

![](é»‘é©¬MySQL(å››).assets/1.png)







## 1.2ã€ä¸€å¯¹å¤š/å¤šå¯¹ä¸€

éƒ¨é—¨å’Œå‘˜å·¥

åˆ†æï¼šä¸€ä¸ªéƒ¨é—¨æœ‰å¤šä¸ªå‘˜å·¥ï¼Œä¸€ä¸ªå‘˜å·¥åªèƒ½å¯¹åº”ä¸€ä¸ªéƒ¨é—¨

å®ç°åŸåˆ™ï¼š==åœ¨å¤šçš„ä¸€æ–¹å»ºç«‹å¤–é”®ï¼ŒæŒ‡å‘ä¸€çš„ä¸€æ–¹çš„ä¸»é”®==

ä¾‹å¦‚ä¸‹æ–¹ä¸¤å¼ è¡¨ï¼Œæˆ‘ä»¬åœ¨å‘˜å·¥è¡¨å»ºç«‹å¤–é”® dept_id, æŒ‡å‘éƒ¨é—¨è¡¨çš„ä¸»é”® deptno

![](é»‘é©¬MySQL(å››).assets/2.png)











## 1.3ã€å¤šå¯¹å¤š

å­¦ç”Ÿå’Œè¯¾ç¨‹

åˆ†æï¼šä¸€ä¸ªå­¦ç”Ÿå¯ä»¥é€‰æ‹©å¾ˆå¤šé—¨è¯¾ç¨‹ï¼Œä¸€ä¸ªè¯¾ç¨‹ä¹Ÿå¯ä»¥è¢«å¾ˆå¤šå­¦ç”Ÿé€‰æ‹©

åŸåˆ™ï¼š**å¤šå¯¹å¤šå…³ç³»å®ç°éœ€è¦å€ŸåŠ©ç¬¬ä¸‰å¼ ä¸­é—´è¡¨ã€‚ä¸­é—´è¡¨è‡³å°‘åŒ…å«ä¸¤ä¸ªå­—æ®µï¼Œå°†å¤šå¯¹å¤šçš„å…³ç³»ï¼Œæ‹†æˆä¸€å¯¹å¤šçš„å…³ç³»ï¼Œä¸­é—´è¡¨è‡³å°‘è¦æœ‰ä¸¤ä¸ªå¤–é”®ï¼Œè¿™ä¸¤ä¸ªå¤–é”®åˆ†åˆ«æŒ‡å‘åŸæ¥çš„é‚£ä¸¤å¼ è¡¨çš„ä¸»é”®**ã€‚

å¦‚ä¸‹è¡¨ï¼Œå­¦ç”Ÿè¡¨å’Œè¯¾ç¨‹è¡¨æ˜¯å¤šå¯¹å¤šå…³ç³»ï¼Œæˆ‘ä»¬ä½¿ç”¨ç¬¬ä¸‰å¼ è¡¨ä½œä¸ºä¸­é—´è¡¨ï¼Œä¸­é—´è¡¨æœ‰ä¸¤ä¸ªå¤–é”®ï¼ŒæŒ‡å‘å­¦ç”Ÿè¡¨å’Œè¯¾ç¨‹è¡¨çš„ä¸»é”®ã€‚

![](é»‘é©¬MySQL(å››).assets/4.png)



# 2ã€å¤–é”®çº¦æŸ

MySQL å¤–é”®çº¦æŸï¼ˆ**FOREIGN KEY**ï¼‰æ˜¯è¡¨çš„ä¸€ä¸ªç‰¹æ®Šå­—æ®µï¼Œç»å¸¸ä¸ä¸»é”®çº¦æŸä¸€èµ·ä½¿ç”¨ã€‚å¯¹äºä¸¤ä¸ªå…·æœ‰å…³è”å…³ç³»çš„è¡¨è€Œè¨€ï¼Œç›¸å…³è”å­—æ®µä¸­**ä¸»é”®æ‰€åœ¨çš„è¡¨å°±æ˜¯ä¸»è¡¨ï¼ˆçˆ¶è¡¨ï¼‰ï¼Œå¤–é”®æ‰€åœ¨çš„è¡¨å°±æ˜¯ä»è¡¨ï¼ˆå­è¡¨ï¼‰ã€‚**

å¤–é”®ç”¨æ¥å»ºç«‹ä¸»è¡¨ä¸ä»è¡¨çš„å…³è”å…³ç³»ï¼Œä¸ºä¸¤ä¸ªè¡¨çš„æ•°æ®å»ºç«‹è¿æ¥ï¼Œçº¦æŸä¸¤ä¸ªè¡¨ä¸­æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªæ°´æœæ‘Šï¼Œåªæœ‰è‹¹æœã€æ¡ƒå­ã€æå­ã€è¥¿ç“œç­‰ 4 ç§æ°´æœï¼Œé‚£ä¹ˆï¼Œä½ æ¥åˆ°æ°´æœæ‘Šè¦ä¹°æ°´æœå°±åªèƒ½é€‰æ‹©è‹¹æœã€æ¡ƒå­ã€æå­å’Œè¥¿ç“œï¼Œå…¶å®ƒçš„æ°´æœéƒ½æ˜¯ä¸èƒ½è´­ä¹°çš„ã€‚



## 2.1ã€ç‰¹ç‚¹

å®šä¹‰ä¸€ä¸ªå¤–é”®æ—¶ï¼Œéœ€è¦éµå®ˆä¸‹åˆ—è§„åˆ™ï¼š

- ä¸»è¡¨å¿…é¡»å·²ç»å­˜åœ¨äºæ•°æ®åº“ä¸­ï¼Œæˆ–è€…æ˜¯å½“å‰æ­£åœ¨åˆ›å»ºçš„è¡¨
- **å¿…é¡»ä¸ºä¸»è¡¨å®šä¹‰ä¸»é”®**
- **ä¸»é”®ä¸èƒ½åŒ…å«ç©ºå€¼ï¼Œä½†å…è®¸åœ¨å¤–é”®ä¸­å‡ºç°ç©ºå€¼ã€‚**
- åœ¨ä¸»è¡¨çš„è¡¨ååé¢æŒ‡å®šåˆ—åæˆ–åˆ—åçš„ç»„åˆã€‚è¿™ä¸ªåˆ—æˆ–åˆ—çš„ç»„åˆå¿…é¡»æ˜¯ä¸»è¡¨çš„ä¸»é”®æˆ–å€™é€‰é”®
- å¤–é”®ä¸­åˆ—çš„æ•°ç›®å¿…é¡»å’Œä¸»è¡¨çš„ä¸»é”®ä¸­åˆ—çš„æ•°ç›®ç›¸åŒ
- å¤–é”®ä¸­åˆ—çš„æ•°æ®ç±»å‹å¿…é¡»å’Œä¸»è¡¨ä¸»é”®ä¸­å¯¹åº”åˆ—çš„æ•°æ®ç±»å‹ç›¸åŒ

![](é»‘é©¬MySQL(å››).assets/3.png)







## 2.2ã€åˆ›å»ºå¤–é”®

### 2.2.1ã€æ–¹å¼ä¸€

æ–¹å¼ä¸€ï¼š**åœ¨åˆ›å»ºè¡¨æ—¶è®¾ç½®å¤–é”®çº¦æŸ**

åœ¨ create table è¯­å¥ä¸­ï¼Œé€šè¿‡ foreign key å…³é”®å­—æ¥æŒ‡å®šå¤–é”®ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

```sql
[constraint <å¤–é”®å>] foreign key å­—æ®µå references <ä¸»è¡¨å> ä¸»é”®åˆ—
```

å®ç°ï¼š

```sql
-- åˆ›å»ºéƒ¨é—¨è¡¨(ä¸»è¡¨)
CREATE TABLE IF NOT EXISTS dept(
    `deptno` VARCHAR(20) PRIMARY KEY, -- éƒ¨é—¨å·
    `name` VARCHAR(20) -- éƒ¨é—¨åå­—
);

-- åˆ›å»ºå‘˜å·¥è¡¨(ä»è¡¨)
CREATE TABLE IF NOT EXISTS emp(
	
    `eid` VARCHAR(20) PRIMARY KEY,	-- å‘˜å·¥ç¼–å·
    `ename` VARCHAR(20), 		-- å‘˜å·¥å§“å
    `age` INT,			-- å‘˜å·¥å¹´é¾„
    `dept_id` VARCHAR(20), -- å‘˜å·¥æ‰€å±éƒ¨é—¨
    
    -- åˆ›å»ºå¤–é”®åç§°ä¸º emp_fk , æ˜¯ä»è¡¨ä¸­çš„dept_idä¾èµ–ä¸»è¡¨ä¸­çš„deptno 
     constraint emp_fk FOREIGN KEY (dept_id) references dept(deptno) -- å¤–é”®çº¦æŸ
);
```

![](é»‘é©¬MySQL(å››).assets/5.png)









### 2.2.2ã€æ–¹å¼äºŒ

æ–¹å¼äºŒï¼šåœ¨åˆ›å»ºè¡¨æ—¶è®¾ç½®å¤–é”®çº¦æŸã€‚

å¤–é”®çº¦æŸä¹Ÿå¯ä»¥åœ¨ä¿®æ”¹è¡¨æ—¶æ·»åŠ ï¼Œä½†æ˜¯æ·»åŠ å¤–é”®çº¦æŸçš„å‰ææ˜¯ï¼šä»è¡¨ä¸­å¤–é”®åˆ—ä¸­çš„æ•°æ®å¿…é¡»ä¸ä¸»è¡¨ä¸­ä¸»é”®åˆ—çš„æ•°æ®ä¸€è‡´æˆ–è€…æ˜¯æ²¡æœ‰æ•°æ®ã€‚

è¯­æ³•ï¼š

```sql
alter table <æ•°æ®è¡¨å> add constraint <å¤–é”®å> foreign key (<åˆ—å>) references <ä¸»è¡¨å>(<åˆ—å>)
```

å®ç°ï¼š

```sql
-- åˆ›å»ºéƒ¨é—¨è¡¨(ä¸»è¡¨)
CREATE TABLE IF NOT EXISTS dept(
    `deptno` VARCHAR(20) PRIMARY KEY, -- éƒ¨é—¨å·
    `name` VARCHAR(20) -- éƒ¨é—¨åå­—
);

-- åˆ›å»ºå‘˜å·¥è¡¨(ä»è¡¨)
CREATE TABLE IF NOT EXISTS emp(
	
    `eid` VARCHAR(20) PRIMARY KEY,	-- å‘˜å·¥ç¼–å·
    `ename` VARCHAR(20), 		-- å‘˜å·¥å§“å
    `age` INT,			-- å‘˜å·¥å¹´é¾„
    `dept_id` VARCHAR(20), -- å‘˜å·¥æ‰€å±éƒ¨é—¨
    
);


-- åˆ›å»ºå¤–é”®çº¦æŸ
-- ç»™è¡¨empæ·»åŠ å¤–é”®åä¸ºdept_id_fk, å¤–é”®dept_idä¾èµ–ä¸»é”®deptno
alter table emp add constraint dept_id_fk foreign key(dept_id) references dept(deptno)
```



## 2.3ã€åœ¨å¤–é”®çº¦æŸä¸‹çš„æ•°æ®æ“ä½œ

### 2.3.1ã€æ·»åŠ æ•°æ®

é¦–å…ˆæˆ‘ä»¬æ·»åŠ æ•°æ®

```sql
-- 1.å¿…é¡»å…ˆç»™ä¸»è¡¨å…ˆæ·»åŠ æ•°æ®
insert into dept values('1001','ç ”å‘éƒ¨');
insert into dept values('1002','é”€å”®éƒ¨');
insert into dept values('1003','è´¢åŠ¡éƒ¨');
insert into dept values('1004','äººäº‹éƒ¨');


-- 2.ç»™ä»è¡¨æ·»åŠ æ•°æ®
-- æ³¨æ„ç»™ä»è¡¨æ·»åŠ æ•°æ®æ—¶ï¼Œå¤–é”®åˆ—çš„å€¼ä¸èƒ½éšä¾¿å†™ï¼Œå¿…é¡»ä¾èµ–ä¸»è¡¨çš„ä¸»é”®åˆ—
insert into emp values('1','ä¹”å³°',20,'1001');
insert into emp values('2','æ®µèª‰',20,'1001');
insert into emp values('3','è™šç«¹',20,'1001');
insert into emp values('4','é˜¿ç´«',20,'1001');
insert into emp values('5','æ‰«åœ°åƒ§',20,'1001');
insert into emp values('1','å°æ—',20,'1005'); -- è¿™ä¸ªå› ä¸ºä¸»è¡¨çš„ä¸»é”®åˆ—ä¸å­˜åœ¨1005,æ‰€ä»¥æ­¤æ¡æ•°æ®æ˜¯æ’å…¥ä¸è¿›å»çš„
```

![](é»‘é©¬MySQL(å››).assets/6.png)





### 2.3.2ã€åˆ é™¤æ•°æ®

æ³¨æ„ï¼š

1. ä¸»è¡¨çš„æ•°æ®è¢«ä»è¡¨ä¾èµ–æ—¶ï¼Œä¸èƒ½åˆ é™¤
2. ä»è¡¨çš„æ•°æ®å¯ä»¥éšä¾¿åˆ é™¤

```sql
delete from dept where deptno = '1001';		-- ä¸å¯ä»¥åˆ é™¤(å› ä¸º1001è¢«ä»è¡¨ä¾èµ–äº†)
delete from dept where deptno = '1004';		-- å¯ä»¥åˆ é™¤(å› ä¸º1004æ²¡æœ‰è¢«ä»è¡¨ä¾èµ–)
delete from emp where eid = '7';			-- å¯ä»¥åˆ é™¤(åˆ é™¤ä»è¡¨å¯ä»¥éšä¾¿åˆ é™¤)
```



### 2.3.3ã€åˆ é™¤å¤–é”®çº¦æŸ

å½“ä¸€ä¸ªè¡¨ä¸­ä¸éœ€è¦å¤–é”®çº¦æŸæ—¶ï¼Œå°±éœ€è¦ä»è¡¨ä¸­å°†å…¶åˆ é™¤ã€‚å¤–é”®ä¸€æ—¦åˆ é™¤ï¼Œå°±ä¼šè§£é™¤ä¸»è¡¨å’Œä»è¡¨é—´çš„å…³è”å…³ç³»ã€‚

æ ¼å¼ï¼š

```sql
alter table <ä»è¡¨å> drop foreign key <å¤–é”®çº¦æŸå>;
```

å®ç°ï¼š

```sql
-- åˆ é™¤è¡¨empçš„å¤–é”® emp_fk
alter table emp drop foreign key  emp_fk;
```







## 2.4ã€å¤–é”®çº¦æŸ-å¤šå¯¹å¤šå…³ç³»ğŸ”¥

åœ¨å¤šå¯¹å¤šå…³ç³»ä¸­ï¼ŒAè¡¨çš„ä¸€è¡Œå¯¹åº”Bçš„å¤šè¡Œï¼ŒBè¡¨çš„ä¸€è¡Œå¯¹åº”Aè¡¨çš„å¤šè¡Œï¼Œæˆ‘ä»¬è¦æ–°å¢åŠ ä¸€ä¸ªä¸­é—´è¡¨ï¼Œæ¥å»ºç«‹å¤šå¯¹å¤šå…³ç³»ã€‚

![](é»‘é©¬MySQL(å››).assets/7.png)



```sql
-- åˆ›å»ºå­¦ç”Ÿè¡¨å’Œè¯¾ç¨‹è¡¨(å¤šå¯¹å¤š)
-- 1.åˆ›å»ºå­¦ç”Ÿè¡¨student(å·¦ä¾§ä¸»è¡¨)
create table if not exists student(
	
    sid int primary key auto_increment,
    name varchar(20),
    age int,
    gender varchar(20)
);


-- 2.åˆ›å»ºè¯¾ç¨‹è¡¨course(å³ä¾§ä¸»è¡¨)
create table course(

	cid int primary key auto_increment,
    cidname varchar(20)
);

-- 3.åˆ›å»ºä¸­é—´è¡¨ student_course/score(ä»è¡¨)
create table score(
	
    sid int,
    cid int,
    score double
);

-- 4.å»ºç«‹å¤–é”®çº¦æŸ(2æ¬¡)
-- ç»™ä»è¡¨scoreæ·»åŠ å¤–é”®çº¦æŸ,ä¸¤ä¸ªå¤–é”®çº¦æŸä¾èµ–ä¸¤ä¸ªä¸»è¡¨
alter table score add foreign key(sid) references student(sid);
alter table score add foreign key(cid) references course(cid);
```

![](é»‘é©¬MySQL(å››).assets/8.png)



- ä¿®æ”¹å’Œåˆ é™¤æ—¶ï¼Œä¸­é—´ä»è¡¨å¯ä»¥éšä¾¿åˆ é™¤ä¿®æ”¹ï¼Œä½†æ˜¯ä¸¤è¾¹çš„ä¸»è¡¨å—ä»è¡¨ä¾èµ–çš„æ•°æ®ä¸èƒ½åˆ é™¤æˆ–è€…ä¿®æ”¹

```sql
-- ç»™å­¦ç”Ÿè¡¨studentæ·»åŠ æ•°æ®
insert into student values(1,'å°é¾™å¥³',18,'å¥³'),(2,'é˜¿ç´«',19,'å¥³'),(3,'å‘¨èŠ·è‹¥',20,'ç”·');
-- ç»™è¯¾ç¨‹è¡¨courseæ·»åŠ æ•°æ®
insert into course values(1,'è¯­æ–‡'),(2,'æ•°å­¦'),(3,'è‹±è¯­');
-- ç»™ä¸­é—´è¡¨scoreæ·»åŠ æ•°æ®
insert into score values(1,1),(1,2),(2,1),(2,3),(3,2),(3,3);

insert into score values(4,1)  -- æŠ¥é”™,å› ä¸ºsidæ²¡æœ‰4çš„
```



![](é»‘é©¬MySQL(å››).assets/9.png)











# 3ã€å¤šè¡¨è”åˆæŸ¥è¯¢ğŸ”¥

å¤šè¡¨æŸ¥è¯¢å°±æ˜¯åŒæ—¶æŸ¥è¯¢ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¡¨ï¼Œå› ä¸ºæœ‰çš„æ—¶å€™ç”¨æˆ·åœ¨æŸ¥çœ‹æ•°æ®çš„æ—¶å€™,éœ€è¦æ˜¾ç¤ºçš„æ•°æ®æ¥è‡ªå¤šå¼ è¡¨ã€‚å¤šè¡¨æŸ¥è¯¢æœ‰ä»¥ä¸‹åˆ†ç±»ï¼š

1. äº¤å‰è¿æ¥æŸ¥è¯¢(äº†è§£)

   ```sql
   select * from A,B
   ```

2. å†…è¿æ¥æŸ¥è¯¢(innerå¯ä»¥çœç•¥)

   ```sql
   select * from A inner join B on æ¡ä»¶;
   ```

3. å¤–è¿æ¥æŸ¥è¯¢(outer å¯ä»¥çœç•¥)

   ```sql
   -- å·¦å¤–è¿æ¥ left outer join
   select * from A left outer join B on æ¡ä»¶;
   
   -- å³å¤–è¿æ¥ right outer join
   select * from A right outer join B on æ¡ä»¶;
   
   -- æ»¡å¤–è¿æ¥ full outer join
   select * from A full outer join B on æ¡ä»¶;
   ```

4. å­æŸ¥è¯¢

   select çš„åµŒå¥—æŸ¥è¯¢

5. è¡¨è‡ªå…³è”

   å°†ä¸€å¼ è¡¨å½“æˆå¤šå¼ è¡¨æ¥ç”¨

![](é»‘é©¬MySQL(å››).assets/10.png)

## 3.1ã€å‡†å¤‡æŸ¥è¯¢æ•°æ®

æ¥ä¸‹æ¥å‡†å¤‡å¤šè¡¨æŸ¥è¯¢éœ€è¦æ•°æ®ï¼Œæ³¨æ„ï¼Œ**å¤–é”®çº¦æŸå¯¹å¤šè¡¨æŸ¥è¯¢å¹¶æ— å½±å“**ã€‚

```sql
-- åˆ›å»ºéƒ¨é—¨è¡¨
create table if not exists dept(
	
    `deptno` varchar(20) primary key,	-- éƒ¨é—¨å·
    `name` varchar(20) -- éƒ¨é—¨åå­—
);

-- åˆ›å»ºå‘˜å·¥è¡¨
creae table if not exusts emp(

    eid varchar(20) primary key,	-- å‘˜å·¥ç¼–å·
    ename varchar(20),		-- å‘˜å·¥åå­—
    age int,		-- å‘˜å·¥å¹´é¾„
    dept_id varchar(20)	 -- å‘˜å·¥æ‰€å±éƒ¨é—¨
);

-- ç»™ dept è¡¨æ·»åŠ æ•°æ®
insert into dept values('1001','ç ”å‘éƒ¨');
insert into dept values('1002','é”€å”®éƒ¨');
insert into dept values('1003','è´¢åŠ¡éƒ¨');
insert into dept values('1004','äººäº‹éƒ¨');

-- ç»™empè¡¨æ·»åŠ æ•°æ®
insert into emp values('1','ä¹”å³°',20,'1001');
insert into emp values('2','æ®µèª‰',20,'1002');
insert into emp values('3','è™šç«¹',20,'1003');
insert into emp values('4','é˜¿ç´«',20,'1004');
insert into emp values('5','æ‰«åœ°åƒ§',20,'1001');
```

![](é»‘é©¬MySQL(å››).assets/6.png)



## 3.2ã€äº¤å‰è¿æ¥æŸ¥è¯¢

**å‡å¦‚Aè¡¨æœ‰mè¡Œæ•°æ®ï¼ŒBè¡¨æœ‰nè¡Œæ•°æ®ï¼Œåˆ™è¿”å›m*nè¡Œæ•°æ®**ã€‚ä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œå°±æ˜¯æ¯ä¸ªå‘˜å·¥å’Œæ¯ä¸ªéƒ¨é—¨æŒ¨ä¸ªåŒ¹é…ã€‚

æ ¼å¼ï¼š

```sql
select * from è¡¨1,è¡¨2,è¡¨3...;
```

å®ç°ï¼š

```sql
-- äº¤å‰è¿æ¥æŸ¥è¯¢
select * from dept,emp;
```

![](é»‘é©¬MySQL(å››).assets/11.png)

**äº¤å‰è¿æ¥äºŒæŸ¥è¯¢ä¼šäº§ç”Ÿå¾ˆå¤šå†—ä½™çš„æ•°æ®ï¼ŒåæœŸçš„å…¶ä»–æŸ¥è¯¢å¯ä»¥åœ¨è¯¥é›†åˆçš„åŸºç¡€ä¸Šè¿›è¡Œæ¡ä»¶ç­›é€‰**



## 3.3ã€å†…è¿æ¥æŸ¥è¯¢

![](é»‘é©¬MySQL(å››).assets/12.png)

æ ¼å¼ï¼š

```sql
-- éšå¼å†…è¿æ¥
select * from A,B where æ¡ä»¶;


-- æ˜¾å¼å†…è¿æ¥(å¸¸ç”¨)
select * from A inner join B on æ¡ä»¶;
```

å®ç°ï¼š

```sql
-- æŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨çš„æ‰€å±å‘˜å·¥(ä¸¤å¼ è¡¨çš„è‚¯å®šæœ‰ä¸€åˆ—æ˜¯ç›¸åŒçš„)
select * from dept inner join emp on dept.deptno = emp.dept_id;
```

![](é»‘é©¬MySQL(å››).assets/13.png)



```sql
-- æŸ¥è¯¢ç ”å‘éƒ¨å’Œé”€å”®éƒ¨çš„æ‰€å±å‘˜å·¥
select * from dept join emp on dept.deptno = emp.dept_id and name in('ç ”å‘éƒ¨','é”€å”®éƒ¨');
```

![](é»‘é©¬MySQL(å››).assets/14.png)



```sql
-- æŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨çš„å‘˜å·¥æ•°ï¼Œå¹¶å‡åºæ’åº
select 
	deptno,count(*) as total_cnt 
from 
	dept inner join emp on dept.deptno = emp.dept_id 
group by 
	deptno 
order by total_cnt;


-- æŸ¥è¯¢äººæ•°å¤§äºç­‰äº3çš„éƒ¨é—¨,å¹¶æŒ‰ç…§äººæ•°é™åºæ’åº
select deptno,count(*) as total_cnt from dept inner join emp on dept.deptno = emp.dept_id group by deptno having total_cnt >= 3 order by total_cnt desc;
```





## 3.4ã€å¤–è¿æ¥æŸ¥è¯¢

**å¤–è¿æ¥åˆ†ä¸ºå·¦å¤–è¿æ¥ã€å³å¤–è¿æ¥**

![](é»‘é©¬MySQL(å››).assets/15.png)



**å·¦å¤–è¿æ¥ï¼šæŠŠå·¦è¡¨çš„æ•°æ®å…¨éƒ¨è¾“å‡ºï¼Œå³è¡¨æœ‰å¯¹åº”çš„æ•°æ®å°±è¾“å‡º**

```sql
select * from A left outer join B on æ¡ä»¶;
```

å³å¤–è¿æ¥ï¼š

```sql
select * from A right outer join B on æ¡ä»¶;
```

å®ç°ï¼š

```sql
-- æŸ¥è¯¢å“ªäº›éƒ¨é—¨æœ‰å‘˜å·¥ï¼Œå“ªäº›éƒ¨é—¨æ²¡æœ‰å‘˜å·¥
select * from dept left outer join emp on dept.deptno = emp.dept_id;
```

![](é»‘é©¬MySQL(å››).assets/16.png)



```sql
-- æŸ¥è¯¢å“ªäº›å‘˜å·¥æœ‰å¯¹åº”çš„éƒ¨é—¨,å“ªäº›æ²¡æœ‰
select * from dept right outer join emp on dept.deptno = emp.dept_id;
```



## 3.5ã€å­æŸ¥è¯¢

å­æŸ¥è¯¢å°±æ˜¯æŒ‡çš„åœ¨ä¸€ä¸ªå®Œæ•´çš„æŸ¥è¯¢è¯­å¥ä¹‹ä¸­ï¼ŒåµŒå¥—è‹¥å¹²ä¸ªä¸åŒåŠŸèƒ½çš„å°æŸ¥è¯¢ï¼Œä»è€Œä¸€èµ·å®Œæˆå¤æ‚æŸ¥è¯¢çš„ä¸€ç§ç¼–å†™å½¢å¼ï¼Œé€šä¿—ä¸€ç‚¹å°±æ˜¯**åŒ…å«selectåµŒå¥—çš„æŸ¥è¯¢**ã€‚

å­æŸ¥è¯¢å¯ä»¥è¿”å›çš„æ•°æ®ç±»å‹ä¸€å…±åˆ†ä¸ºå››ç§ï¼š

1. å•è¡Œå•åˆ—ï¼šè¿”å›çš„æ˜¯ä¸€ä¸ªå…·ä½“åˆ—çš„å†…å®¹ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå•å€¼æ•°æ®
2. å•è¡Œå¤šåˆ—ï¼šè¿”å›ä¸€è¡Œæ•°æ®ä¸­å¤šä¸ªåˆ—çš„å†…å®¹
3. å¤šè¡Œå•åˆ—ï¼šè¿”å›å¤šè¡Œè®°å½•ä¹‹ä¸­åŒä¸€åˆ—çš„å†…å®¹ï¼Œç›¸å½“äºç»™å‡ºäº†ä¸€ä¸ªæ“ä½œèŒƒå›´
4. å¤šè¡Œå¤šåˆ—ï¼šæŸ¥è¯¢è¿”å›çš„ç»“æœæ˜¯ä¸€å¼ ä¸´æ—¶è¡¨

ç»“æœæ˜¯å¦‚ä¸‹å›¾æƒ…å†µçš„ï¼Œæˆ‘ä»¬å¯ä»¥å†æ¬¡æŸ¥è¯¢

![](é»‘é©¬MySQL(å››).assets/17.png)

```sql
-- æŸ¥è¯¢å¹´é¾„æœ€å¤§çš„å‘˜å·¥ä¿¡æ¯,æ˜¾ç¤ºä¿¡æ¯åŒ…å«å‘˜å·¥å·ã€å‘˜å·¥åå­—ã€å‘˜å·¥å¹´é¾„
-- select max(age) from emp æ‰¾å¯»æœ€å¤§çš„å‘˜å·¥å¹´é¾„
select eid,ename,age from emp where age = (select max(age) from emp);

-- åˆ†æ­¥è§£é‡Š
select max(age) from emp; -- 20
select eid,ename,age from emp where age = 20;

-- æˆ‘ä»¬æŸ¥å‡ºæœ€å¤§å¹´é¾„ä¸º20,åªè¦ç»™æ¡ä»¶å½“æŸä¸ªå‘˜å·¥å¹´é¾„åŒ¹é…åˆ°20,æˆ‘ä»¬å°±å½“ä»–æ˜¯æœ€å¤§å¹´é¾„çš„å‘˜å·¥
select eid,ename,age from emp where age = (select max(age) from emp);
```

![](é»‘é©¬MySQL(å››).assets/18.png)



```sql
-- æŸ¥è¯¢ç ”å‘éƒ¨å’Œé”€å”®éƒ¨çš„å‘˜å·¥ä¿¡æ¯,åŒ…å«å‘˜å·¥å·ã€å‘˜å·¥åå­—
-- æ–¹å¼ä¸€:å¤šè¡¨æŸ¥è¯¢
select * from dept a join emp b on a.deptno = b.dept_id and (name = 'ç ”å‘éƒ¨' or name = 'é”€å”®éƒ¨');

-- æ–¹å¼äºŒï¼šå­æŸ¥è¯¢
select * from emp where dept_id in (select deptno from dept where name = 'ç ”å‘éƒ¨' or name = 'é”€å”®éƒ¨');

-- æ–¹å¼äºŒæ­¥éª¤è§£æ
-- 1. å…ˆæŸ¥è¯¢ç ”å‘éƒ¨å’Œé”€å”®éƒ¨çš„éƒ¨é—¨å· 1001ã€1002
select deptno from dept where name = 'ç ”å‘éƒ¨' or name = 'é”€å”®éƒ¨';
-- 2. æŸ¥è¯¢å“ªä¸ªå‘˜å·¥çš„éƒ¨é—¨å·æ˜¯ 1001ã€1002
select * from emp where dept_id in ('1001','1002');
```

![](é»‘é©¬MySQL(å››).assets/19.png)



```sql
-- æŸ¥è¯¢ç ”å‘éƒ¨30å²ä»¥ä¸‹çš„å‘˜å·¥ä¿¡æ¯
-- æ–¹å¼ä¸€:å…³è”æŸ¥è¯¢
select * from dept a join emp b on a.deptno = b.dept_id and (name = 'ç ”å‘éƒ¨' and age < 20);

-- å­æŸ¥è¯¢
-- 1.åœ¨éƒ¨é—¨è¡¨ä¸­æŸ¥è¯¢ç ”å‘éƒ¨ä¿¡æ¯
select * from dept where name = 'ç ”å‘éƒ¨';
-- 2.åœ¨å‘˜å·¥è¡¨ä¸­æŸ¥è¯¢å¹´é¾„å°äº20å²çš„å‘˜å·¥ä¿¡æ¯
select * from emp where age < 30;
-- 3.å°†ä»¥ä¸Šä¸¤ä¸ªæŸ¥è¯¢çš„ç»“æœè¿›è¡Œå…³è”æŸ¥è¯¢
select * from (select * from dept where name = 'ç ”å‘éƒ¨') t1 join (select * from emp where age < 30) t2 on t1.deptno = t2.dept_id;
```



### 3.5.1ã€å­æŸ¥è¯¢å…³é”®å­—

åœ¨å­æŸ¥è¯¢ä¸­ï¼Œæœ‰ä¸€äº›å¸¸ç”¨çš„é€»è¾‘å…³é”®å­—ï¼Œè¿™äº›å…³é”®å­—å¯ä»¥ç»™æˆ‘ä»¬æä¾›æ›´ä¸°å¯Œçš„æŸ¥è¯¢åŠŸèƒ½ï¼Œä¸»è¦å…³é”®å­—å¦‚ä¸‹:

- all å…³é”®å­—
- any å…³é”®å­—
- some å…³é”®å­—
- in å…³é”®å­—
- exists å…³é”®å­—

### 3.5.2ã€all

æ ¼å¼ï¼š

```sql
select * from <è¡¨å> where c > all(æŸ¥è¯¢è¯­å¥)
-- ç­‰ä»·äº
select * from <è¡¨å> where c > result1 and c > result2 and c > result3
```

ç‰¹ç‚¹ï¼š

- allï¼šä¸å­æŸ¥è¯¢è¿”å›çš„æ‰€æœ‰å€¼æ¯”è¾ƒï¼Œä¸ºtrueåˆ™è¿”å›true
- all å¯ä»¥ä¸ =ã€ > ã€>= ã€<ã€<= ã€<> ç»“åˆæ¥ä½¿ç”¨ï¼Œåˆ†åˆ«è¡¨ç¤ºç­‰äºã€å¤§äºã€å¤§äºç­‰äºã€å°äºã€å°äºç­‰äºã€ä¸ç­‰äºå…¶ä¸­çš„çš„æ‰€æœ‰æ•°æ®
- all è¡¨ç¤ºæŒ‡å®šåˆ—ä¸­çš„å€¼å¿…é¡»è¦å¤§äºå­æŸ¥è¯¢é›†çš„æ¯ä¸€ä¸ªå€¼ï¼Œå³å¿…é¡»è¦å¤§äºå­æŸ¥è¯¢é›†çš„æœ€å¤§å€¼ã€‚å¦‚æœæ˜¯å°äºå·å³å°äºå­æŸ¥è¯¢é›†çš„æœ€å°å€¼ã€‚

å®ç°ï¼š

```sql
-- æŸ¥è¯¢å¹´é¾„å¤§äº '1003' éƒ¨é—¨æ‰€æœ‰å¹´é¾„çš„å‘˜å·¥ä¿¡æ¯
select * from emp where age > all(select age from emp where dept_id = '1003');

-- æŸ¥è¯¢ä¸å±äºä»»ä½•ä¸€ä¸ªéƒ¨é—¨çš„å‘˜å·¥ä¿¡æ¯
select * from emp where dept_id != all(select deptno from dept);
```



### 3.5.3ã€any

```sql
select * from <è¡¨å> where c > any(æŸ¥è¯¢è¯­å¥)
-- ç­‰ä»·äº
select * from <è¡¨å> where c > result1 or c > result2 or c > result3
```

ç‰¹ç‚¹ï¼š

- è¡¨ç¤ºæŒ‡å®šåˆ—ä¸­çš„å€¼è¦å¤§äºå­æŸ¥è¯¢ä¸­çš„ä»»æ„ä¸€ä¸ªå€¼ï¼Œå³å¿…é¡»è¦å¤§äºå­æŸ¥è¯¢é›†ä¸­çš„æœ€å°å€¼ã€‚
- **some å’Œ any çš„ä½œç”¨ä¸€æ ·ï¼Œ some å¯ä»¥ç†è§£ä¸º any çš„åˆ«å** (any ç”¨çš„æ›´å¤š)ã€‚

å®ç°ï¼š

```sql
-- æŸ¥è¯¢å¹´é¾„å¤§äº'1001'éƒ¨é—¨ä»»æ„ä¸€ä¸ªå‘˜å·¥å¹´é¾„çš„å‘˜å·¥ä¿¡æ¯
select * from emp where age > all(select age from emp where dept_id = '1001');
```







### 3.5.4ã€in

```sql
select * from <è¡¨å> where c in(æŸ¥è¯¢è¯­å¥)
-- ç­‰ä»·äº
select * from <è¡¨å> where c = result1 or c = result2 or c = result3
```

ç‰¹ç‚¹ï¼š

- INå…³é”®å­—ï¼Œç”¨äºåˆ¤æ–­æŸä¸ªè®°å½•çš„å€¼ï¼Œæ˜¯å¦åœ¨æŒ‡å®šçš„é›†åˆä¸­
- åœ¨INå…³é”®å­—å‰è¾¹åŠ ä¸Šnotå¯ä»¥å°†æ¡ä»¶åè¿‡æ¥

æ“ä½œï¼š

```sql
-- æŸ¥è¯¢ç ”å‘éƒ¨å’Œé”€å”®éƒ¨çš„å‘˜å·¥ä¿¡æ¯
select * from emp where dept_id in(select deptno from dept where name = 'ç ”å‘éƒ¨' or name = 'é”€å”®éƒ¨');
```





### 3.5.5ã€exists

```sql
select * from <è¡¨å> where  exists(æŸ¥è¯¢è¯­å¥)
```

ç‰¹ç‚¹ï¼š

- è¯¥å­æŸ¥è¯¢å¦‚æœâ€œæœ‰æ•°æ®ç»“æœâ€(è‡³å°‘è¿”å›ä¸€è¡Œæ•°æ®)ï¼Œ åˆ™è¯¥EXISTS() çš„ç»“æœä¸ºâ€œtrueâ€ï¼Œå¤–å±‚æŸ¥è¯¢æ‰§è¡Œ
- è¯¥å­æŸ¥è¯¢å¦‚æœâ€œæ²¡æœ‰æ•°æ®ç»“æœâ€ï¼ˆæ²¡æœ‰ä»»ä½•æ•°æ®è¿”å›ï¼‰ï¼Œåˆ™è¯¥EXISTS()çš„ç»“æœä¸ºâ€œfalseâ€ï¼Œå¤–å±‚æŸ¥è¯¢ä¸æ‰§è¡Œ
- EXISTSåé¢çš„å­æŸ¥è¯¢ä¸è¿”å›ä»»ä½•å®é™…æ•°æ®ï¼Œåªè¿”å›çœŸæˆ–å‡ï¼Œå½“è¿”å›çœŸæ—¶ whereæ¡ä»¶æˆç«‹
- æ³¨æ„ï¼ŒEXISTSå…³é”®å­—ï¼Œæ¯”INå…³é”®å­—çš„è¿ç®—æ•ˆç‡é«˜ï¼Œå› æ­¤ï¼Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œç‰¹åˆ«æ˜¯å¤§æ•°æ®é‡æ—¶ï¼Œæ¨èä½¿ç”¨EXISTSå…³é”®å­—

å®ç°ï¼š

```sql
-- æŸ¥è¯¢å…¬å¸æ˜¯å¦æœ‰å¤§äº18å²çš„å‘˜å·¥ï¼Œæœ‰åˆ™è¾“å‡º
select * from emp a where exists(select * from emp b where a.age > 18); 

-- è§£æ
select * from emp b where a.age > 18ï¼› -- è¿™ä¸ªç»“æœå¦‚æœæœ‰æ•°æ®,åˆ™å¤–å±‚æŸ¥è¯¢è¯­å¥ select * from emp æ‰æ‰§è¡Œ

-- æ‰€ä»¥å®é™…ä¸Šå¦‚æœexists() æœ‰æ•°æ®,ç›¸å½“äºæ‰§è¡Œäº† select * from emp
-- å¦‚æœ exists() æ²¡æœ‰æ•°æ®,åˆ™ç›¸å½“äºä¸æ‰§è¡Œ
```







# 4ã€è‡ªå…³è”æŸ¥è¯¢

MySQLæœ‰æ—¶åœ¨ä¿¡æ¯æŸ¥è¯¢æ—¶éœ€è¦è¿›è¡Œå¯¹è¡¨è‡ªèº«è¿›è¡Œå…³è”æŸ¥è¯¢ï¼Œå³ä¸€å¼ è¡¨è‡ªå·±å’Œè‡ªå·±å…³è”ï¼Œä¸€å¼ è¡¨å½“æˆå¤šå¼ è¡¨æ¥ç”¨ã€‚**æ³¨æ„è‡ªå…³è”æ—¶è¡¨å¿…é¡»ç»™è¡¨èµ·åˆ«åã€‚**

æ ¼å¼ï¼š

```sql
select å­—æ®µåˆ—è¡¨ from è¡¨1 a [left] join è¡¨1 b on æ¡ä»¶;
```

å®ç°ï¼š

```sql
-- åˆ›å»ºè¡¨,å¹¶å»ºç«‹è‡ªå…³è”çº¦æŸ
create table t_sanguo(
	
    eid int primary key,   -- å‘˜å·¥ç¼–å·
    ename varchar(20),     -- å‘˜å·¥åå­—
    manager_id int,        -- ä¸Šçº§é¢†å¯¼ç¼–å·
    -- manager_id æ˜¯å¤–é”®,å—åˆ°ä¸»é”® eid çš„çº¦æŸ.é¢†å¯¼ç¼–å·ä¹Ÿå±äºå‘˜å·¥ç¼–å·
    foreign key(manager_id) references t_sanguo(eid) -- æ·»åŠ è‡ªå…³è”çº¦æŸ
);

-- æ·»åŠ æ•°æ®
insert into t_sangguo values(1,'åˆ˜å¤‡',NULL);
insert into t_sangguo values(2,'å…³ç¾½',1);
insert into t_sangguo values(3,'å¼ é£',2);
insert into t_sangguo values(4,'æ›¹æ“',2);
insert into t_sangguo values(5,'è®¸è¯¸',1);
insert into t_sangguo values(6,'å…¸éŸ¦',5);
insert into t_sangguo values(7,'å­™æƒ',5);

-- è¿›è¡Œå…³è”æŸ¥è¯¢
-- 1.æŸ¥è¯¢æ¯ä¸ªä¸‰å›½äººç‰©åŠä»–çš„ä¸Šçº§é¢†å¯¼ä¿¡æ¯
select a.ename,b.ename from t_sanguo a join t_sanguo b on a.manager_id = b.eid;

-- 2.æŸ¥è¯¢æ‰€æœ‰äººç‰©ã€ä¸Šçº§ã€ä¸Šä¸Šçº§
select 
	a.ename,b.ename,c.ename 
from t_sanguo a 
	left join t_sanguo b on a.manager_id = b.eid
	left join t_sanguo c on b.manager_id = c.eid;
```







# 5ã€å¤šè¡¨æŸ¥è¯¢ç»ƒä¹ 









































# 6ã€MySQLå‡½æ•°

## 6.1ã€èšåˆå‡½æ•°

`group_concat()` å‡½æ•°é¦–å…ˆæ ¹æ® group by æŒ‡å®šçš„åˆ—è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ä¸”ç”¨åˆ†éš”ç¬¦åˆ†éš”ï¼Œå°†åŒä¸€ä¸ªåˆ†ç»„ä¸­çš„å€¼è¿æ¥èµ·æ¥ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ç»“æœã€‚

æ ¼å¼ï¼š

```sql
group_concat([distinct] å­—æ®µå [order by æ’åºå­—æ®µ asc/desc] [separator 'åˆ†éš”ç¬¦']) 
```

è¯´æ˜ï¼š

- ä½¿ç”¨distinctå¯ä»¥æ’é™¤é‡å¤å€¼ï¼›
- å¦‚æœéœ€è¦å¯¹ç»“æœä¸­çš„å€¼è¿›è¡Œæ’åºï¼Œå¯ä»¥ä½¿ç”¨ order byå­å¥
- separatoræ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å€¼ï¼Œé»˜è®¤ä¸ºé€—å·

```sql
create table emp(
    emp_id int primary key auto_increment comment 'ç¼–å·',
    emp_name char(20) not null default '' comment 'å§“å',
    salary decimal(10,2) not null default 0 comment 'å·¥èµ„',
    department char(20) not null default '' comment 'éƒ¨é—¨'
);

insert into emp(emp_name,salary,department) 
values('å¼ æ™¶æ™¶',5000,'è´¢åŠ¡éƒ¨'),('ç‹é£é£',5800,'è´¢åŠ¡éƒ¨'),('èµµåˆš',6200,'è´¢åŠ¡éƒ¨'),('åˆ˜å°è´',5700,'äººäº‹éƒ¨'),('ç‹å¤§é¹',6700,'äººäº‹éƒ¨'),('å¼ å°æ–',5200,'äººäº‹éƒ¨'),('åˆ˜äº‘äº‘',7500,'é”€å”®éƒ¨'),('åˆ˜äº‘é¹',7200,'é”€å”®éƒ¨'),('åˆ˜äº‘é¹',7800,'é”€å”®éƒ¨');

-- å°†æ‰€æœ‰å‘˜å·¥çš„åå­—åˆå¹¶æˆä¸€è¡Œ
select group_concat(emp_name) from emp;

-- æŒ‡å®šåˆ†éš”ç¬¦åˆå¹¶
select department,group_concat(emp_name separator ';' ) from emp group by department; 

-- æŒ‡å®šæ’åºæ–¹å¼å’Œåˆ†éš”ç¬¦ 
select department,group_concat(emp_name order by salary desc separator ';' ) from emp group by department;
```

![](é»‘é©¬MySQL(å››).assets/20.png)





## 6.2ã€æ•°å­¦å‡½æ•°

| å‡½æ•°å                      | æè¿°                                             | å®ä¾‹                                                         |
| --------------------------- | ------------------------------------------------ | ------------------------------------------------------------ |
| abs(x)                      | è¿”å›xçš„ç»å¯¹å€¼                                    | è¿”å›-1çš„ç»å¯¹å€¼<br>select ABS(-1)  -- 1                       |
| celf(x)                     | è¿”å›å¤§äºæˆ–ç­‰äºxçš„æœ€å°æ•´æ•°(å‘ä¸Šå–æ•´)              | select celf(1.5) -- 2                                        |
| floor(x)                    | è¿”å›å°äºæˆ–ç­‰äºxçš„æœ€å¤§æ•´æ•°(å‘ä¸‹å–æ•´)              | select floor(1.5) -- 1                                       |
| greatest(expr1,expr2......) | è¿”å›åˆ—è¡¨ä¸­çš„æœ€å¤§å€¼                               | select greatest(3,12,34) -- 34<br>è¿”å›ä»¥ä¸‹å­—ç¬¦ä¸²åˆ—è¡¨çš„æœ€å¤§å€¼<br>select greatest("Google","Runoob") -- Runoob |
| least(expr1,expr2......)    | è¿”å›åˆ—è¡¨ä¸­çš„æœ€å°å€¼                               | select greatest(3,12,34) -- 3<br/>è¿”å›ä»¥ä¸‹å­—ç¬¦ä¸²åˆ—è¡¨çš„æœ€å°å€¼<br/>select greatest("Google","Runoob","Apple") -- Apple |
| max(expression)             | è¿”å›å­—æ®µ expression ä¸­çš„æœ€å¤§å€¼                   | select max(price) from products;                             |
| min(expression)             | è¿”å›å­—æ®µ expression ä¸­çš„æœ€å°å€¼                   |                                                              |
| mod(xï¼Œy)                   | è¿”å› x é™¤ä»¥ y ä»¥åçš„ä½™æ•°                         | select mod(5,2) -- 1                                         |
| pi()                        | è¿”å›åœ†å‘¨ç‡                                       | select pi()                                                  |
| pow(x,y)                    | è¿”å› x çš„ y æ¬¡æ–¹                                 | select pow(2,3) -- 8                                         |
| rand()                      | è¿”å›0åˆ°1çš„éšæœºæ•°                                 | select rand()                                                |
| round()                     | è¿”å›ç¦»xæœ€è¿‘çš„æ•´æ•°(éµå¾ªå››èˆäº”å…¥)                  | select round(1.2323) -- 1                                    |
| round(x,y)                  | è¿”å›æŒ‡å®šä½æ•°çš„å°æ•°(éµå¾ªå››èˆäº”å…¥)                 | select round(1.23456,3) -- 1.235                             |
| truncate(x,y)               | è¿”å›æ•°å€¼ x ä¿ç•™åˆ°å°æ•°ç‚¹å y ä½çš„å€¼(ä¸ä¼šå››èˆäº”å…¥) | select truncate(1.23456,3) --1.234                           |





## 6.3ã€å­—ç¬¦ä¸²å‡½æ•°

| å‡½æ•°                   | æè¿°                                                         | å®ä¾‹                                                         |
| ---------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| char_length(s)         | è¿”å›å­—ç¬¦ä¸² s çš„å­—ç¬¦æ•°                                        | select char_length("RUNOOB") -- 6                            |
| character_length(s)    | è¿”å›å­—ç¬¦ä¸² s çš„å­—ç¬¦æ•°                                        | select character_length("RUNOOB")                            |
| concat(s1,s2....)      | å­—ç¬¦ä¸² s1,s2 ç­‰å¤šä¸ªå­—ç¬¦ä¸²åˆå¹¶ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²                    | select concat("SQL","Runoob")                                |
| concat_ws(x,s1,s2....) | åŒ concat å‡½æ•°ä¸€æ ·ï¼Œä½†æ˜¯æ¯ä¸ªå­—ç¬¦ä¸²ä¹‹é—´è¦åŠ ä¸Š xï¼Œxå¯ä»¥æ˜¯åˆ†éš”ç¬¦ | select concat_ws("-","SQL","is")                             |
| field(s,s1,s2....)     | è¿”å›ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²såœ¨å­—ç¬¦ä¸²åˆ—è¡¨(s1ï¼Œs2...)ä¸­çš„ä½ç½®             | è¿”å›å­—ç¬¦ä¸² c åœ¨åˆ—è¡¨å€¼ä¸­çš„ä½ç½®ï¼š<br>select field("c","a","b","c") -- 3 |
| ltrim(s)               | å»æ‰å­—ç¬¦ä¸² s å¼€å§‹å¤„çš„ç©ºæ ¼                                    | select ltrim("    RUNOOB")                                   |
| mid(s,n,len)           | ä»å­—ç¬¦ä¸² s çš„ n ä½ç½®æˆªå–é•¿åº¦ä¸º len çš„å­å­—ç¬¦ä¸²                | ä»å­—ç¬¦ä¸² RUNOOB ä¸­çš„ç¬¬ 2 ä¸ªä½ç½®æˆªå–<br>select mid("RUNOOB", 2, 3) -- UNO |
| position(s1 in s)      | ä»å­—ç¬¦ä¸² s ä¸­è·å– s1 çš„å¼€å§‹ä½ç½®                              | è¿”å›å­—ç¬¦ä¸² abc ä¸­ b çš„ä½ç½®<br>select position('b' in 'abc') -- 2 |
| replace(s,s1,s2)       | å°†å­—ç¬¦ä¸² s2 æ›¿ä»£å­—ç¬¦ä¸² s ä¸­çš„å­—ç¬¦ä¸² s1                       | å°†å­—ç¬¦ä¸² abc ä¸­çš„å­—ç¬¦ a æ›¿æ¢ä¸ºå­—ç¬¦ x<br>select replace('abc','a','x') --xbc |
| reverse(s)             | å°†å­—ç¬¦ä¸²sçš„é¡ºåºåè¿‡æ¥                                        | å°†å­—ç¬¦ä¸² abc çš„é¡ºåºåè¿‡æ¥<br>select reverse('abc') -- cba    |
| right(s,n)             | è¿”å›å­—ç¬¦ä¸² s çš„å n ä¸ªå­—ç¬¦                                   | è¿”å›å­—ç¬¦ä¸² runoob çš„åä¸¤ä¸ªå­—ç¬¦<br>select right('runoob',2) -- ob |
| rtrim(s)               | å»æ‰å­—ç¬¦ä¸² s ç»“å°¾å¤„çš„ç©ºæ ¼                                    | select rtrim("RUNOOB    ")                                   |
| strcmp(s1,s2)          | æ¯”è¾ƒå­—ç¬¦ä¸² s1 å’Œ s2ï¼Œå¦‚æœ s1 ä¸ s2 ç›¸ç­‰è¿”å› 0 ï¼Œå¦‚æœ s1>s2 è¿”å› 1ï¼Œå¦‚æœ s1<s2 è¿”å› -1 | select strcmp("runoob","runoob") -- 0                        |
| substr(s,start,length) | ä»å­—ç¬¦ä¸² s çš„ strat ä½ç½®æˆªå–é•¿åº¦ä¸º length çš„å­å­—ç¬¦ä¸²         |                                                              |
| trim(s)                | å»æ‰å­—ç¬¦ä¸² s å¼€å§‹å’Œç»“å°¾å¤„çš„ç©ºæ ¼                              |                                                              |
| ucase                  | å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¤§å†™                                           |                                                              |
| upper(s)               | å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¤§å†™                                           |                                                              |
| lcase(s)               | å°†å­—ç¬¦ä¸² s çš„æ‰€æœ‰å­—æ¯å˜æˆå°å†™å­—æ¯                            |                                                              |
| lower(s)               | å°†å­—ç¬¦ä¸² s çš„æ‰€æœ‰å­—æ¯å˜æˆå°å†™å­—æ¯                            |                                                              |







## 6.4ã€æ—¥æœŸå‡½æ•°

| å‡½æ•°å                                          | æè¿°                                  | å®ä¾‹                                                         |
| ----------------------------------------------- | ------------------------------------- | ------------------------------------------------------------ |
| unix_timestamp()                                | è¿”å›ä»1970-01-01 00:00:00åˆ°å½“å‰æ¯«ç§’å€¼ | select unix_timestamp()                                      |
| unix_timestamp(date_string)                     | å°†åˆ¶å®šæ—¥æœŸè½¬ä¸ºæ¯«ç§’å€¼æ—¶é—´æˆ³            | select unix_timestamp('2001-08-09 13:01:03')                 |
| from_unixtime(bigint unixtime [,string format]) | å°†æ¯«ç§’å€¼æ—¶é—´æˆ³è½¬ä¸ºæŒ‡å®šæ ¼å¼æ—¥æœŸ        | select from_unixtime(997333263,'%Y-%m-%d %H:%i:%s')          |
| curdate()                                       | è¿”å›å½“å‰æ—¥æœŸ                          | select curdate()                                             |
| current_time                                    | è¿”å›å½“å‰æ—¶é—´                          | select current_time                                          |
| current_timestamp()                             | è¿”å›å½“å‰æ—¥æœŸå’Œæ—¶é—´                    | select current_timestamp()                                   |
| date()                                          | ä»æ—¥æœŸæˆ–æ—¥æœŸæ—¶é—´è¡¨è¾¾å¼ä¸­æå–æ—¥æœŸå€¼    | select date("2023-01-01") -- 2023-01-01                      |
| datediff(d1,d2)                                 | è®¡ç®—æ—¥æœŸd1 -> d2 ä¹‹é—´ç›¸éš”çš„å¤©æ•°       |                                                              |
| timediff(time1,time2)                           | è®¡ç®—æ—¶é—´å·®å€¼                          |                                                              |
| data_format(d,f)                                | æŒ‰è¡¨è¾¾å¼ f çš„è¦æ±‚æ˜¾ç¤ºæ—¥æœŸ d           | select date_format('2011-11-11 11:11:11','%Y-%m-%d %r') -- 2011-11-11 11:11:11 AM |
| str_to_date(string,format_mask)                 | å°†å­—ç¬¦ä¸²è½¬å˜ä¸ºæ—¥æœŸ                    | select str_to_date("August 10 2017","%M %d %Y") -- 2017-08-10 |
| date_sub(date,interval expr type)               | å‡½æ•°ä»æ—¥æœŸå‡å»æŒ‡å®šçš„æ—¶é—´é—´éš”          | Orders è¡¨ä¸­ OrderDate å­—æ®µå‡å» 2 å¤©<br>select OrderId,date_sub(OrderDate,interval 2 day) from Orders |



## 6.5ã€æ§åˆ¶æµå‡½æ•°

### 6.5.1ã€if

| æ ¼å¼                | è§£é‡Š                                                         | æ¡ˆä¾‹                             |
| ------------------- | ------------------------------------------------------------ | -------------------------------- |
| if(expr,v1,v2)      | å¦‚æœè¡¨è¾¾å¼ expr æˆç«‹ï¼Œè¿”å›ç»“æœ v1ï¼›å¦åˆ™ï¼Œè¿”å›ç»“æœ v2         | select if(1>0,'æ­£ç¡®','é”™è¯¯')     |
| ifnull(v1,v2)       | å¦‚æœ v1 çš„å€¼ä¸ä¸º NULLï¼Œåˆ™è¿”å› v1ï¼Œå¦åˆ™è¿”å› v2                | select ifnull(null,'Hello Word') |
| isnull(expression)  | åˆ¤æ–­è¡¨è¾¾å¼æ˜¯å¦ä¸º NULL                                        | select isnull(null) -- 1         |
| nullif(expr1,expr2) | æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚æœå­—ç¬¦ä¸² expr1 ä¸ expr2 ç›¸ç­‰ è¿”å› NULLï¼Œå¦åˆ™è¿”å› expr1 | select nullif(25,25)             |









### 6.5.2ã€case when è¯­å¥

```sql
case expression
	when condition1 then result1
	when condition2 then result2
	...
	else result
end
```

- case è¡¨ç¤ºå‡½æ•°å¼€å§‹ï¼Œend è¡¨ç¤ºå‡½æ•°ç»“æŸã€‚
- å¦‚æœ condition1 æˆç«‹ï¼Œåˆ™è¿”å› result1 ã€‚å¦‚æœ condition2 æˆç«‹ï¼Œåˆ™è¿”å› result2ï¼Œå½“å…¨éƒ¨ä¸æˆç«‹åˆ™è¿”å› resultã€‚è€Œå½“æœ‰ä¸€ä¸ªæˆç«‹ä¹‹åï¼Œåé¢çš„å°±ä¸æ‰§è¡Œäº†

```sql
select case 100
	when 50 then 'tom' 
	when 100 then 'mary'
	else 'tim'
end
```

---

å®é™…æ¡ˆä¾‹ï¼š

```sql
-- åˆ›å»ºè®¢å•è¡¨
create table orders(
 oid int primary key, -- è®¢å•id
 price double, -- è®¢å•ä»·æ ¼
 payType int -- æ”¯ä»˜ç±»å‹(1:å¾®ä¿¡æ”¯ä»˜ 2:æ”¯ä»˜å®æ”¯ä»˜ 3:é“¶è¡Œå¡æ”¯ä»˜ 4ï¼šå…¶ä»–)
);

insert into orders values(1,1200,1);
insert into orders values(2,1000,2);
insert into orders values(3,200,3);
insert into orders values(4,3000,1);
insert into orders values(5,1500,2);

-- æ–¹å¼ä¸€
select 
*  ,
case 
  when payType=1 then 'å¾®ä¿¡æ”¯ä»˜' 
    when payType=2 then 'æ”¯ä»˜å®æ”¯ä»˜' 
    when payType=3 then 'é“¶è¡Œå¡æ”¯ä»˜' 
    else 'å…¶ä»–æ”¯ä»˜æ–¹å¼' 
end  as payTypeStr
from orders;

-- æ–¹å¼äºŒ
select 
*  ,
case payType
  when 1 then 'å¾®ä¿¡æ”¯ä»˜' 
    when 2 then 'æ”¯ä»˜å®æ”¯ä»˜' 
    when 3 then 'é“¶è¡Œå¡æ”¯ä»˜' 
    else 'å…¶ä»–æ”¯ä»˜æ–¹å¼' 
end  as payTypeStr
from orders;

```



































































































